# Logbook â€“ Step 1.2

## ğŸ“… Date: 05-09-2025

### ğŸ¯ Goal
- [ ] Build image FE, BE tá»« requirement vÃ  file giáº£ dockerfile pseudo.dockerfile.
- [ ] Pull image MySQL & import dá»¯ liá»‡u.
- [ ] Deploy cho á»©ng dá»¥ng cháº¡y tá»« cÃ¡c container riÃªng láº».

### ğŸ›  Steps Taken
1. Build thá»­ image Backend, Frontend.
2. Build xong -> pull image MySQL, chuáº©n bá»‹ biáº¿n mÃ´i trÆ°á»ng.
3. Deploy container DB. Import data vÃ o MySQL
4. Deploy container BE. Connect Ä‘áº¿n DB vÃ  kiá»ƒm tra káº¿t ná»‘i.
5. Deploy container FE. Kiá»ƒm tra call API Ä‘áº¿n BE.

### ğŸ› Issues & Fixes
- Issue: â€¦
- Fix: â€¦

### ğŸ“š Notes
#### 1/ Trong code FE, file `frontend/src/api.js`, Ä‘oáº¡n nÃ y cáº§n cÃ i Ä‘áº·t nhÆ° nÃ o Ä‘á»ƒ phá»¥c vá»¥ viá»‡c build nhá»‰ ?, cáº£ á»Ÿ chá»— BE cÅ©ng cÃ³ Ä‘oáº¡n fixed port?

```
const API = axios.create({
  baseURL: "http://localhost:4000/api"
});
```
  - ThÃ´ng thÆ°á»ng, chá»‰ sá»­ dá»¥ng khi dev á»Ÿ trÃªn local, vÃ¬ port cá»§a BE vÃ  FE Ä‘á»u náº±m trÃªn cÃ¹ng 1 mÃ¡y.
  - Khi cháº¡y báº±ng Docker Compose:
    - Báº¡n sáº½ Ä‘áº·t cáº£ BE vÃ  FE trong má»™t network â†’ FE pháº£i gá»i BE qua service name (vÃ­ dá»¥ *backend:4000* thay vÃ¬ *localhost:4000*). 
    - CÃ³ 2 cÃ¡ch:
      - CÃ¡ch Ä‘Æ¡n giáº£n: hardcode thÃ nh "http://backend:4000/api".
      - CÃ¡ch tá»‘t hÆ¡n: dÃ¹ng biáº¿n mÃ´i trÆ°á»ng trong React (`REACT_APP_API_URL`).
  - Khi cháº¡y trÃªn Kubernetes:
    - FE sáº½ gá»i BE qua Service name mÃ  báº¡n define trong manifest. VÃ­ dá»¥, náº¿u báº¡n cÃ³ Service backend-svc expose port 4000, thÃ¬ FE pháº£i gá»i: "http://backend-svc:4000/api"
    - ThÆ°á»ng thÃ¬ sáº½ Ä‘á»ƒ Nginx Ingress route /api vá» backend luÃ´n, nhÆ° váº­y FE chá»‰ gá»i "/api" mÃ  khÃ´ng cáº§n biáº¿t backend á»Ÿ Ä‘Ã¢u.  
  - **Giáº£i phÃ¡p**: NÃªn chuyá»ƒn baseURL thÃ nh configurable:
```
const API = axios.create({
  baseURL: process.env.REACT_APP_API_URL || "http://localhost:4000/api"
});
```
#### 2/ BE vÃ  FE Ä‘á»u dÃ¹ng node, tsao BE láº¡i cháº¡y node trong khi FE láº¡i copy ra nginx ?
  - Backend (BE â€“ Express API)
    - Vai trÃ²: cháº¡y API (Node.js server).
    - NÃ³ pháº£i cháº¡y runtime Node.js vÃ¬ code backend lÃ  JavaScript cháº¡y trÃªn mÃ´i trÆ°á»ng Node.
    - VÃ¬ váº­y trong Dockerfile, cuá»‘i cÃ¹ng sáº½ lÃ : `CMD ["node", "src/index.js"]` Ä‘á»ƒ khá»Ÿi Ä‘á»™ng server API.
  - Frontend (FE â€“ React SPA)
    - Vai trÃ²: chá»‰ lÃ  UI static file (HTML, CSS, JS) sau khi npm run build.
    - React khÃ´ng cáº§n Node.js Ä‘á»ƒ cháº¡y ngoÃ i production â€” Node.js chá»‰ cáº§n cho build.
    - Sau khi build xong, ta Ä‘Æ°á»£c thÆ° má»¥c build/ chá»©a file tÄ©nh, cÃ³ thá»ƒ serve báº±ng báº¥t cá»© web server nÃ o (Nginx, Apache, Caddy...).
    ğŸ‘‰ VÃ¬ váº­y ta thÆ°á»ng dÃ¹ng multi-stage build:
      - Stage 1: Node.js build ra file tÄ©nh (`npm run build`).
      - Stage 2: Copy file tÄ©nh sang Nginx (nháº¹ hÆ¡n, tá»‘i Æ°u hÆ¡n, production standard).

    - Náº¿u FE cÅ©ng Ä‘á»ƒ Node cháº¡y npm start thÃ¬ váº«n Ä‘Æ°á»£c, nhÆ°ng:
      - `npm start (react-scripts)` chá»‰ dÃ nh cho dev.
      - Runtime sáº½ tá»‘n nhiá»u RAM/CPU hÆ¡n cáº§n thiáº¿t, khÃ´ng cache tá»‘t báº±ng Nginx.
- Ghi nhá»›: â€¦

### âœ… Result
á»¨ng dá»¥ng cháº¡y thÃ nh cÃ´ng: â†’ FE hiá»ƒn thá»‹ Todo list tá»« DB.
